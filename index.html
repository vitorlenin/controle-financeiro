<!DOCTYPE html>

<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="#0b1220" name="theme-color"/>
<title>Controle Financeiro</title>
<link href="/favicon.png" rel="icon"/>
<!-- Fonte padr√£o de sistemas (SaaS) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<link href="./manifest.json" rel="manifest">
<link href="./css/styles.css" rel="stylesheet"/>
</link></head>
<body>
<div class="app">
<header class="topbar"><div class="leftControls">
<button aria-label="Menu" class="iconBtn mobileOnly" id="btnMenu" title="Menu" type="button">‚ò∞</button>
<button aria-label="Voltar" class="btn btn--ghost btnBack" id="btnBack" style="display:none;" title="Voltar" type="button">
          ‚Üê
          <span class="btnBack__text">Voltar</span>
</button>
</div><div aria-label="Identifica√ß√£o do app" class="brand"><div class="brand__title">Controle Financeiro <span class="muted" id="versionBadge">(v7.0.7)</span></div></div><div class="actions">
<button class="btn btn--ghost" id="btnLogout" style="display:none;" title="Sair">Sair</button>
<button class="btn btn--primary" id="btnLogin">G Entrar com Google</button>
</div><div aria-label="Status e vers√£o" class="topmeta"><div class="muted small" id="versionInfo">v7.0.7</div><div class="pill" id="authStatus">Deslogado</div></div><nav class="tabs">
<button class="tab is-active" data-route="dashboard">Dashboard</button>
<button class="tab" data-route="lancamentos">Lan√ßamentos</button>
<button class="tab" data-route="relatorios">Relat√≥rios</button>
<button class="tab" data-route="categorias">Configura√ß√µes</button>
<button class="tab" data-route="backup">Backup / Import</button>
</nav></header>
<aside aria-hidden="true" class="drawer" id="drawer">
<div class="drawer__backdrop" id="drawerBackdrop"></div>
<div class="drawer__panel">
<div class="drawer__title">Menu</div>
<button class="drawer__item" data-route="dashboard" type="button">Dashboard</button>
<button class="drawer__item" data-route="lancamentos" type="button">Lan√ßamentos</button>
<button class="drawer__item" data-route="relatorios" type="button">Relat√≥rios</button>
<button class="drawer__item" data-route="categorias" type="button">Configura√ß√µes</button>
<button class="drawer__item" data-route="backup" type="button">Backup / Import</button>
</div>
</aside>
<main class="panel">
<section class="view is-visible" id="view-dashboard">
<div class="sectionTitle">
<div>
<h2>Resumo ‚Ä¢ M√™s atual</h2>
<p class="hint">Dica: clique em um card para filtrar a lista de lan√ßamentos.</p>
</div>
</div>
<div class="cards">
<button class="card card--blue" data-filter="saldo" id="cardSaldo" type="button">
<div class="card__header">
<span>Saldo do m√™s</span>
<span class="badge">üí∞</span>
</div>
<div class="card__value" id="saldoMes">R$ 0,00</div>
<div class="card__footer">
<span class="muted">Total de lan√ßamentos</span>
<span id="totalLanc">0</span>
</div>
</button>
<button class="card card--green" data-filter="entradas" id="cardEntradas" type="button">
<div class="card__header">
<span>Entradas</span>
<span class="badge">üßæ</span>
</div>
<div class="card__value" id="entradasMes">R$ 0,00</div>
<div class="card__footer">
<span class="muted">Sal√°rio fixo</span>
<span id="entradasFixas">R$ 0,00</span>
</div>
</button>
<button class="card card--red" data-filter="saidas" id="cardSaidas" type="button">
<div class="card__header">
<span>Sa√≠das</span>
<span class="badge">üìâ</span>
</div>
<div class="card__value" id="saidasMes">R$ 0,00</div>
<div class="card__footer">
<span class="muted">Top categoria</span>
<span id="topCat">‚Äî</span>
</div>
</button>
<button class="card card--gold" data-filter="renda_extra" id="cardExtra" type="button">
<div class="card__header">
<span>Renda extra</span>
<span class="badge">‚≠ê</span>
</div>
<div class="card__value" id="extraMes">R$ 0,00</div>
<div class="card__footer">
<span class="muted">Entradas (extra)</span>
<span id="qtExtra">0</span>
</div>
</button>
</div>

<div class="forecastBar">
  <div class="forecastTitle">Previs√£o</div>
  <div class="forecastItems">
    <div class="forecastItem"><span class="muted">Saldo at√© hoje</span> <b id="saldoAteHoje">R$ 0,00</b></div>
    <div class="forecastItem"><span class="muted">Saldo previsto (fim do m√™s)</span> <b id="saldoPrevisto">R$ 0,00</b></div>
  </div>
  <div class="forecastHint muted small" id="saldoPrevistoHint">Inclui lan√ßamentos futuros e recorrentes.</div>
</div>
<div class="grid2">
<div class="box box--compact">
<div class="box__title">
<h3>Vis√£o r√°pida</h3>
<p class="muted small">Gastos por categoria (m√™s atual).</p>
</div>
<div class="chartWrap">
<div class="chartHeader">
<div class="muted small">Pizza + legenda</div>
</div>
<div class="pieGrid">
<canvas height="260" id="pieCanvas" width="420"></canvas>
<div class="legend" id="pieLegend"></div>
</div>
<div class="chartEmpty" id="chartEmpty">Sem dados para exibir.</div>
</div>
</div>
<div class="box box--compact">
<div class="box__title">
<h3>Atalhos</h3>
<p class="muted small">Adicionar lan√ßamento r√°pido.</p>
</div>
<form class="form" id="quickForm">
<div class="row2">
<label class="field">
<span>Descri√ß√£o *</span>
<input id="qDesc" placeholder="Ex: Mercado, Internet, Sal√°rio" required="" type="text"/>
</label>
<label class="field">
<span>Valor (R$) *</span>
<input id="qValor" min="0" placeholder="0,00" required="" step="0.01" type="number"/>
</label>
</div>
<div class="row2">
<label class="field">
<span>Tipo</span>
<select id="qTipo">
<option value="saida">Sa√≠da</option>
<option value="entrada">Entrada</option>
</select>
</label>
<label class="field" id="qFonteWrap">
<span>Fonte</span>
<select id="qFonte">
<option value="salario_fixo">Sal√°rio fixo</option>
<option value="renda_extra">Renda extra</option>
<option value="outros">Outros</option>
</select>
</label>
</div>
<div class="row2">
<label class="field">
<span>Categoria</span>
<select id="qCategoria">
<option>Agua</option>
<option>Alimenta√ß√£o</option>
<option>Cart√£o</option>
<option>Celular</option>
<option>Combust√≠vel</option>
<option>Internet</option>
<option>Lazer</option>
<option>Mercado</option>
<option>Moradia</option>
<option>Sa√∫de</option>
<option>Transporte</option>
<option>Outros</option>
</select>
</label>
<label class="field">
<span>Subcategoria</span>
<select id="qSubcategoria">
<option value="">‚Äî</option>
</select>
</label>
<label class="field">
<span>Data</span>
<input id="qData" type="date"/>
</label>
</div>

<div class="row3" id="qPayRow">
  <label class="field">
    <span>Pagamento</span>
    <select id="qPayMethod">
      <option value="dinheiro">Dinheiro</option>
      <option value="pix">Pix</option>
      <option value="debito">D√©bito</option>
      <option value="credito">Cart√£o de cr√©dito</option>
    </select>
  </label>
  <label class="field" id="qCardWrap" style="display:none;">
    <span>Cart√£o</span>
    <input type="hidden" id="qCard" value=""/>
    <button type="button" id="qCardBtn" class="selectLike" aria-haspopup="dialog" aria-expanded="false">
      <span id="qCardBtnText">Selecione um cart√£o‚Ä¶</span>
      <span class="chev">‚ñæ</span>
    </button>
  </label>
  <label class="field" id="qInstWrap" style="display:none;">
    <span>Parcelas</span>
    <input id="qInstallments" type="number" min="1" max="24" step="1" value="1"/>
    <div class="muted small" style="margin-top:6px;" id="qInstHint">Ao salvar, vou criar 1 lan√ßamento por m√™s.</div>
  </label>
  <div class="muted small" id="qInvoiceHint"  style="align-self:end; text-align:right;"></div>
</div>

<!-- Shown when editing a launch: allow converting a normal launch into recurring -->
<div class="row2" id="qRecRow" style="display:none; align-items:center;">
  <label class="check">
    <input id="qMakeRecurring" type="checkbox"/>
    <span>Tornar recorrente</span>
  </label>
  <div class="muted small" id="qMakeRecurringNote" style="justify-self:end; text-align:right;"></div>
</div>
<div class="row2 actionsRow">
<button class="btn btn--primary" id="btnSalvar" type="submit">Salvar</button>
<button class="btn btn--ghost" id="btnVerLanc" type="button">Ver lan√ßamentos</button>
</div>
<div class="quickMsgRow"><div class="formMsg" id="quickMsg"></div><button class="btn btn--ghost btn--sm" id="btnLimparEdicao" type="button" style="display:none;">Limpar</button></div>
</form>
</div>
</div>
</section>
<section class="view" id="view-lancamentos">
<div class="sectionTitle">
<div>
<h2>Lan√ßamentos</h2>
<p class="hint">Voc√™ pode ver em <b>cards</b> e em <b>tabela</b>. Filtros valem para os dois.</p>
</div>
</div>
<div class="box box--compact">
<div class="filters">
<label class="field">
<span>M√™s</span>
<input id="fMes" type="month"/>
</label>
<label class="field">
<span>Tipo</span>
<select id="fTipo">
<option value="todos">Todos</option>
<option value="entrada">Entrada</option>
<option value="saida">Sa√≠da</option>
</select>
</label>
<label class="field">
<span>Fonte</span>
<select id="fFonte">
<option value="todas">Todas</option>
<option value="salario_fixo">Sal√°rio fixo</option>
<option value="renda_extra">Renda extra</option>
<option value="outros">Outros</option>
</select>
</label>
<label class="field">
<span>Pagamento</span>
<select id="fPay">
<option value="todas">Todos</option>
<option value="dinheiro">Dinheiro</option>
<option value="pix">Pix</option>
<option value="debito">D√©bito</option>
<option value="credito">Cart√£o de cr√©dito</option>
</select>
</label>
</label>
<label class="field">
<span>Buscar</span>
<input id="fBusca" placeholder="Descri√ß√£o ou categoria..." type="text"/>
</label>
<button class="btn btn--ghost" id="btnLimparFiltro" type="button">Limpar</button>
<button class="btn btn--ghost" id="btnRecorrentes" type="button">Recorrentes</button>
</div>
<div class="viewToggle">
<button class="seg is-active" id="segCards" type="button">Cards</button>
<button class="seg" id="segTabela" type="button">Tabela</button>
</div>
<div class="cardsList" id="cardsLanc"></div>
<div class="tableWrap" id="tableWrap">
<table class="table">
<thead>
<tr>
<th>Data</th>
<th>Descri√ß√£o</th>
<th>Categoria</th>
<th>Tipo</th>
<th>Fonte</th>
<th>Pagamento</th>
<th class="right">Valor</th>
<th class="right">A√ß√µes</th>
</tr>
</thead>
<tbody id="tbodyLanc"></tbody>
</table>
</div>
<div class="empty" id="emptyLanc">Nenhum lan√ßamento encontrado.</div>
</div>
</section>

<dialog class="dlg" id="dlgRecorrentes">
  <div class="dlg__head">
    <div>
      <div class="dlg__title">Lan√ßamentos recorrentes</div>
      <div class="muted small">Cria lan√ßamentos automaticamente todo m√™s (quando voc√™ abrir o app).</div>
    </div>
    <button class="btn btn--ghost" id="btnFecharRec" type="button">Fechar</button>
  </div>

  <div class="dlg__body">
    <div class="boxInner" style="margin-bottom:12px;">
      <h3 class="h3" id="recFormTitle">Adicionar recorrente</h3>
      <div class="row2">
        <label class="field">
          <span>Descri√ß√£o</span>
          <input id="recDesc" placeholder="Ex: Internet" type="text"/>
        </label>
        <label class="field">
          <span>Valor</span>
          <input id="recValor" min="0" placeholder="0" step="0.01" type="number"/>
        </label>
      </div>
      <div class="row3">
        <label class="field">
          <span>Dia do m√™s</span>
          <input id="recDia" max="31" min="1" step="1" type="number" value="5"/>
        </label>
        <label class="field">
          <span>Tipo</span>
          <select id="recTipo">
            <option value="saida">Sa√≠da</option>
            <option value="entrada">Entrada</option>
          </select>
        </label>
        <label class="field">
          <span>Fonte</span>
          <select id="recFonte">
            <option value="outros">Outros</option>
            <option value="salario_fixo">Sal√°rio fixo</option>
            <option value="renda_extra">Renda extra</option>
          </select>
        </label>
      </div>
      <div class="row3">
        <label class="field">
          <span>Categoria</span>
          <select id="recCategoria"></select>
        </label>
        <label class="field">
          <span>Subcategoria</span>
          <select id="recSubcategoria"></select>
        </label>
        <label class="field">
          <span>Come√ßar em</span>
          <input id="recStart" type="month"/>
        </label>
      </div>
      <div class="row2 recActionsRow" style="align-items:center;">
        <label class="check">
          <input id="recAtivo" checked type="checkbox"/>
          <span>Ativo</span>
        </label>
        <div class="recActions">
          <button class="btn btn--ghost" id="btnRecCancelar" type="button">Cancelar</button>
          <button class="btn btn--primary" id="btnRecSalvar" type="button">Salvar</button>
        </div>
      </div>
      <div class="formMsg" id="recMsg"></div>
    </div>

    <div class="boxInner" id="boxCardForm">
      <h3 class="h3">Lista</h3>
      <div id="recWrap"></div>
      <div class="muted small" style="margin-top:10px;">Dica: os lan√ßamentos gerados ficam no m√™s correspondente e podem ser editados normalmente.</div>
    </div>
  </div>
</dialog>
<section class="view" id="view-relatorios">
<div class="sectionTitle">
<div>
<h2>Relat√≥rios</h2>
<p class="hint">Mensal e semanal, com exporta√ß√£o CSV e ‚ÄúPDF‚Äù via impress√£o.</p>
</div>
</div>
<div class="box">
<div class="filters reportFilters">
<label class="field">
<span>Modo</span>
<select id="rModo">
<option value="mensal">Mensal</option>
<option value="semanal">Semanal</option>
<option value="periodo">Per√≠odo</option>
</select>
</label>
<label class="field" id="wrapMes">
<span>M√™s</span>
<input id="rMes" type="month"/>
</label>
<label class="field" id="wrapSemana">
<span>Semana (qualquer dia)</span>
<input id="rSemana" type="date"/>
</label>
<label class="field" id="wrapDe">
<span>De</span>
<input id="rDe" type="date"/>
</label>
<label class="field" id="wrapAte">
<span>At√©</span>
<input id="rAte" type="date"/>
</label>
<button class="btn btn--primary" id="btnGerarRel" type="button">Gerar</button>
</div>
<div class="reportActions">
<button class="btn btn--ghost" id="btnCsv" type="button">Exportar CSV</button>
<button class="btn btn--ghost" id="btnPdf" type="button">Exportar PDF</button>
<button class="btn btn--ghost" id="btnCartoes" type="button">Faturas</button>
</div>
<div class="reportGrid">
<div class="reportCard">
<div class="muted">Entradas</div>
<div class="big" id="repEntradas">R$ 0,00</div>
<div class="muted small">Sal√°rio fixo + renda extra em destaque</div>
<div class="miniRow">
<span class="miniTag">Fixas</span><span id="repFixas">R$ 0,00</span>
</div>
<div class="miniRow">
<span class="miniTag">Extra</span><span id="repExtra">R$ 0,00</span>
</div>
</div>
<div class="reportCard">
<div class="muted">Sa√≠das</div>
<div class="big" id="repSaidas">R$ 0,00</div>
<div class="muted small">Top categoria + distribui√ß√£o</div>
</div>
<div class="reportCard">
<div class="muted">Saldo</div>
<div class="big" id="repSaldo">R$ 0,00</div>
<div class="muted small" id="repPeriodo">‚Äî</div>
</div>
</div>
<div class="boxInner">
<h3 class="h3">Gastos por categoria</h3>
<div class="chips" id="repCats"></div>
</div>
<div aria-hidden="true" class="printArea" id="printArea"></div>
</div>
</section>
<section class="view" id="view-categorias">
<div class="sectionTitle">
  <div>
    <h2>Configura√ß√µes</h2>
    <p class="hint">Gerencie <b>categorias</b>, <b>subcategorias</b> e <b>cart√µes</b>.</p>
  </div>
</div>

<div class="box">
  <div class="box__title">
    <h3>Categorias e subcategorias</h3>
    <p class="muted small">Use para organizar seus lan√ßamentos. Excluir n√£o apaga lan√ßamentos antigos.</p><br>
  </div>

  <div class="btnRow">
    <button class="btn btn--primary btnWide" id="btnOpenAddCat" type="button"><span class="btnIcon" aria-hidden="true">Ôºã</span><span>Nova categoria</span></button>
    <button class="btn btn--primary btnWide" id="btnOpenAddSub" type="button"><span class="btnIcon" aria-hidden="true">Ôºã</span><span>Nova subcategoria</span></button>
  </div>
</div>

<div class="box">
  <div class="box__title">
    <h3>Lista</h3>
    <p class="muted small">Clique em editar/excluir para gerenciar.</p>
  </div>
  <div id="catsWrap"></div>
</div>

<div class="box">
  <div class="box__title">
    <h3>Cart√µes de cr√©dito</h3>
    <p class="muted small">Cadastre e edite seus cart√µes (fechamento, vencimento e limite opcional).</p><br>
  </div>
  <button class="btn btn--primary btnWide" id="btnGerenciarCartoes" type="button"><span class="btnIcon" aria-hidden="true">üí≥</span><span>Gerenciar cart√µes</span></button>
</div>
</section>


<section class="view" id="view-backup">
<div class="sectionTitle">
<div>
<h2>Backup / Import</h2>
<p class="hint">Exporta e importa seus lan√ßamentos (JSON). √ötil para manter vers√µes est√°veis.</p>
</div>
</div>
<div class="box">
<div class="backupGrid">
<div class="boxInner">
<h3 class="h3">Exportar</h3>
<p class="muted small">Gera um arquivo JSON com todos os lan√ßamentos do seu usu√°rio.</p>
<button class="btn btn--primary" id="btnExportar" type="button">Baixar backup</button>
<div class="formMsg" id="bkMsg"></div>
</div>
<div class="boxInner">
<h3 class="h3">Importar</h3>
<p class="muted small">Selecione um JSON exportado. Voc√™ pode escolher ‚ÄúMesclar‚Äù ou ‚ÄúSubstituir‚Äù.</p>
<label class="field">
<span>Arquivo JSON</span>
<input accept="application/json" id="fileImport" type="file"/>
</label><br>
<div class="row2">
<button class="btn btn--ghost" id="btnImportMesclar" type="button">Importar (mesclar)</button>
<button class="btn btn--danger" id="btnImportSubst" type="button">Importar (substituir)</button>
</div>
<div class="formMsg" id="imMsg"></div>
</div>
</div>
</div>
</section>
<footer class="footer">
<span class="muted small">Dados por usu√°rio ‚Ä¢ Firestore ‚Ä¢ HTML/JS puro ‚Ä¢ Vitor Lenin</span>
</footer>
</main>


<dialog class="dlg" id="dlgCartoes">
  <div class="dlg__head">
    <div>
      <div class="dlg__title" id="dlgCartoesTitle">Cart√µes e Faturas</div>
      <div class="muted small">Marque compras no cart√£o e veja a fatura por m√™s (com fechamento/vencimento).</div>
    </div>
    <button class="btn btn--ghost" id="btnFecharCartoes" type="button">Fechar</button>
  </div>

  <div class="dlg__body">
    <div class="grid2">
      <div class="boxInner">
        <h3 class="h3" id="cardFormTitle">Adicionar cart√£o</h3>
        <div class="row2">
          <label class="field">
            <span>Nome do cart√£o</span>
            <input id="cardNome" placeholder="Ex: Nubank" type="text"/>
          </label>
          <label class="field">
            <span>Limite (opcional)</span>
            <input id="cardLimite" min="0" placeholder="0" step="0.01" type="number"/>
          </label>
        </div>
        <div class="row2">
          <label class="field">
            <span>Fechamento (dia)</span>
            <input id="cardFechamento" max="28" min="1" step="1" type="number" value="10"/>
          </label>
          <label class="field">
            <span>Vencimento (dia)</span>
            <input id="cardVencimento" max="28" min="1" step="1" type="number" value="5"/>
          </label>
        </div>
        <div class="row2 actionsRow">
          <button class="btn btn--ghost" id="btnCardCancelar" type="button">Cancelar</button>
          <button class="btn btn--primary" id="btnCardSalvar" type="button">Salvar</button>
        </div>
        <div class="formMsg" id="cardMsg"></div>
      </div>

      <div class="boxInner">
        <h3 class="h3">Fatura</h3>
        <div class="row2">
          <label class="field">
            <span>Cart√£o</span>
            <select id="fatCard"></select>
          </label>
          <label class="field">
            <span>M√™s da fatura</span>
            <input id="fatMes" type="month"/>
          </label>
        </div>

        <div class="forecastBar" style="margin-top:10px;">
          <div class="forecastTitle">Resumo</div>
          <div class="forecastItems">
            <div class="forecastItem"><span class="muted">Total</span> <b id="fatTotal">R$ 0,00</b></div>
            <div class="forecastItem"><span class="muted">Status</span> <b id="fatStatus">Em aberto</b></div>
          </div>
          <div class="forecastHint muted small" id="fatDatas">Fechamento: ‚Äî ‚Ä¢ Vencimento: ‚Äî</div>
        </div>

        <div class="row2" style="margin-top:10px; align-items:center;">
          <button class="btn btn--ghost" id="btnFatMarcarPaga" type="button">Marcar como paga</button>
          <button class="btn btn--ghost" id="btnFatDesmarcar" type="button">Desmarcar</button>
        </div>

        <div class="cardsList" id="fatLista" style="margin-top:10px;"></div>
        <div class="empty" id="fatEmpty" style="display:none;">Sem compras no cart√£o neste m√™s.</div>
        <div class="muted small" style="margin-top:10px;">Dica: compras no cart√£o entram na fatura conforme o dia de fechamento.</div>
      </div>
    </div>

    <div class="boxInner" id="boxCardsList" style="margin-top:12px;">
      <h3 class="h3">Meus cart√µes</h3>
      <div id="cardsWrap"></div>
    </div>
  </div>
</dialog>

<dialog class="dlg" id="dlgCatEdit">
  <div class="dlg__head">
    <div>
      <div class="dlg__title">Editar categoria</div>
      <div class="muted small">Altere o nome e a cor da categoria.</div>
    </div>
    <button class="btn btn--ghost" id="btnFecharCatEdit" type="button">Fechar</button>
  </div>
  <div class="dlg__body">
    <div class="boxInner">
      <div class="row2">
        <label class="field" style="flex:1;">
          <span>Nome</span>
          <input id="editCatNome" type="text"/>
        </label>
        <label class="field" style="max-width:260px;">
          <span>Cor</span>
          <input id="editCatCor" type="hidden" value="#2563EB"/>
          <div class="palette" id="editCatCorPalette" aria-label="Selecionar cor da categoria"></div>
        </label>
      </div>
      <div class="row2" style="margin-top:12px;">
        <button class="btn btn--primary" id="btnSalvarCatEdit" type="button">Salvar</button>
        <button class="btn btn--ghost" id="btnCancelarCatEdit" type="button">Cancelar</button>
      </div>
      <div class="formMsg" id="editCatMsg"></div>
    </div>
  </div>
</dialog>




</div>
<!-- Firebase (compat) for maximum browser support -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
<script defer src="./js/ui.js"></script>
<script defer src="./js/auth.js"></script>
<script defer src="./js/categorias.js"></script>
<script defer src="./js/lancamentos.js"></script>
<script defer src="./js/relatorios.js"></script>
<script defer src="./js/dashboard.js"></script>
<script defer src="./js/backup.js"></script>
<script defer src="./js/app.js"></script>
<script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").then((reg) => {
        // for√ßa checar updates sempre que abrir
        reg.update().catch(()=>{});

        // Se existir uma vers√£o nova esperando, ativa e recarrega
        if (reg.waiting) {
          reg.waiting.postMessage({ type: "SKIP_WAITING" });
        }

        reg.addEventListener("updatefound", () => {
          const newWorker = reg.installing;
          if (!newWorker) return;
          newWorker.addEventListener("statechange", () => {
            if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
              newWorker.postMessage({ type: "SKIP_WAITING" });
            }
          });
        });

        navigator.serviceWorker.addEventListener("controllerchange", () => {
          // quando a nova SW assume controle, recarrega para pegar arquivos atualizados.
          // Por√©m, durante login via Redirect (mobile), um reload pode interromper o retorno do Google.
          try {
            if (sessionStorage.getItem("cf_auth_redirect") === "1") return;
          } catch (_) {}
          window.location.reload();
        });
      }).catch(()=>{});
    }
  </script>


<!-- Add Category Modal -->
<div class="modalOverlay" id="catAddModal" style="display:none;" role="dialog" aria-modal="true" aria-label="Nova categoria">
  <div class="modalSheet">
    <div class="modalHead">
      <div class="modalTitle">Nova categoria</div>
      <button class="iconBtn" id="catAddClose" type="button" aria-label="Fechar">‚úï</button>
    </div>
    <div class="modalBody">
      <div class="row2" style="align-items:flex-end;">
        <label class="field" style="flex:1;">
          <span>Nome da categoria</span>
          <input id="catNome" placeholder="Ex: Pets, Educa√ß√£o, Impostos" type="text"/>
        </label>
        <label class="field" style="max-width:240px;">
          <span>Cor</span>
          <input id="catCor" type="hidden" value="#2563EB"/>
          <div class="palette" id="catCorPalette" aria-label="Selecionar cor da categoria"></div>
        </label>
      </div>
      <div class="formMsg" id="catMsg"></div>
      <div class="modalActions">
        <button class="btn btn--ghost" id="catAddCancel" type="button">Cancelar</button>
        <button class="btn btn--primary" id="btnAddCat" type="button">Salvar</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Subcategory Modal -->
<div class="modalOverlay" id="subAddModal" style="display:none;" role="dialog" aria-modal="true" aria-label="Nova subcategoria">
  <div class="modalSheet">
    <div class="modalHead">
      <div class="modalTitle">Nova subcategoria</div>
      <button class="iconBtn" id="subAddClose" type="button" aria-label="Fechar">‚úï</button>
    </div>
    <div class="modalBody">
      <div class="row2" style="align-items:flex-end;">
        <label class="field" style="flex:1;">
          <span>Nome da subcategoria</span>
          <input id="subNome" placeholder="Ex: Farm√°cia, Academia" type="text"/>
        </label>
        <label class="field" style="max-width:260px;">
          <span>Categoria</span>
          <select id="subCatSelect">
            <option value="">‚Äî</option>
          </select>
        </label>
      </div>
      <div class="formMsg" id="subMsg"></div>
      <div class="modalActions">
        <button class="btn btn--ghost" id="subAddCancel" type="button">Cancelar</button>
        <button class="btn btn--primary" id="btnAddSub" type="button">Salvar</button>
      </div>
    </div>
  </div>
</div>


<!-- Card picker (custom dropdown) -->
<div class="modalOverlay" id="cardPickerModal" style="display:none;" role="dialog" aria-modal="true" aria-label="Selecionar cart√£o">
  <div class="modalSheet">
    <div class="modalHead">
      <div class="modalTitle">Selecionar cart√£o</div>
      <button class="iconBtn" id="cardPickerClose" type="button" aria-label="Fechar">‚úï</button>
    </div>
    <div class="modalBody" id="cardPickerList"></div>
  </div>
</div>

</body>
</html>